<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
                      "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en">
<head>
    <title>3 Authentication Endpoint 1.4.0.M2</title>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
    <link rel="stylesheet" href="../css/main.css" type="text/css" media="screen, print" title="Style" charset="utf-8"/>
    <link rel="stylesheet" href="../css/pdf.css" type="text/css" media="print" title="PDF" charset="utf-8"/>
    <script type="text/javascript">
function addJsClass() {
    var classes = document.body.className.split(" ");
    classes.push("js");
    document.body.className = classes.join(" ");
}
    </script>
</head>

<body class="body" onload="addJsClass();">
<div id="navigation">
    <ul>
        <li>
            <div id="nav-summary" onmouseover="toggleNavSummary(false)" onmouseout="toggleNavSummary(true)">
                <a href="../guide/index.html" class="button">Table of contents</a>

                <div id="nav-summary-childs" style="display:none;">
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/introduction.html"><strong>1</strong><span>Introduction to the Spring Security REST plugin</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/configuration.html"><strong>2</strong><span>Configuration</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/authentication.html"><strong>3</strong><span>Authentication Endpoint</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tokenGeneration.html"><strong>4</strong><span>Token Generation</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tokenStorage.html"><strong>5</strong><span>Token Storage</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/tokenValidation.html"><strong>6</strong><span>Token Validation Filter</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/cors.html"><strong>7</strong><span>CORS support</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/oauth.html"><strong>8</strong><span>Delegating authentication to OAuth providers</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/debugging.html"><strong>9</strong><span>Debugging</span></a>
                    </div>
                    
                    <div class="toc-item" style="margin-left:0"><a href="../guide/faq.html"><strong>10</strong><span>Frequently Asked Questions</span></a>
                    </div>
                    
                </div>
            </div>
        </li>
        <li class="separator selected">
            <a id="ref-button" onclick="localToggle(); return false;" href="#">Quick Reference</a>
        </li>
    </ul>
</div>
<div id="header">
    <div class="images clearfix">
        
        
    </div>
    <p>Implements authentication for REST APIs based on Spring Security. It uses a token-based workflow</p>
</div>


<table id="colset" border="0" cellpadding="0" cellspacing="0">
    <tr>
        <td id="col1">
            <div id="main" class="corner-all">

                
                    <div class="toc-item prev-left"><a href="../guide/configuration.html">&lt;&lt; <strong>2</strong><span>Configuration</span></a></div>
                

                <span id='toggle-col1' class="toggle">(<a href="#" onclick="localToggle(); return false;">Quick Reference</a>)</span>

                
                    <div class="toc-item next-right"><a href="../guide/tokenGeneration.html"><strong>4</strong><span>Token Generation</span> >></a></div>
                


                <div class="project">
                    <h1>3 Authentication Endpoint - Reference Documentation</h1>

                    <p><strong>Authors:</strong> Alvaro Sanchez-Mariscal</p>

                    <p><strong>Version:</strong> 1.4.0.M2</p>

                    
                </div>

                
                <div id="table-of-content">
                    <h2>Table of Contents</h2>
                    
                    <div class="toc-item" style="margin-left:0px"><a href="#logout"><strong>3.1</strong><span>Logout Endpoint</span></a>
                    </div>
                    
                </div>
                

                

<h1 id="authentication">3 Authentication Endpoint</h1>
The <a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/com/odobo/grails/plugin/springsecurity/rest/RestAuthenticationFilter.html" target="blank">authentication filter</a>
uses the default <code>authenticationManager</code> bean, which in turn uses all the registered authentication
providers. See the <a href="http://grails-plugins.github.io/grails-spring-security-core/docs/manual/guide/authenticationProviders.html" target="blank">Spring Security Core guide</a>
for more information about how to define your own providers. Note that you can easily plug any Spring Security sub-plugin
(like the LDAP one) to use a different authentication strategy.<p class="paragraph"/>If the authentication is successful, a <a href="../guide/single.html#tokenGeneration" class="guide">token generator</a> is used to generate a token, and a
<a href="../guide/single.html#tokenStorage" class="guide">token storage</a> implementation is used to store the token.<p class="paragraph"/>Finally, the JSON response sent back to the client is rendered by a <code>restAuthenticationTokenJsonRenderer</code> bean. The plugin
offers you a <a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/com/odobo/grails/plugin/springsecurity/rest/token/rendering/DefaultRestAuthenticationTokenJsonRenderer.html" target="blank">default implementation</a>
that renders a response like this:<p class="paragraph"/><div class="code"><pre>&#123;
    <span class="java&#45;quote">"username"</span>: <span class="java&#45;quote">"john.doe"</span>,
    <span class="java&#45;quote">"token"</span>: <span class="java&#45;quote">"1a2b3c4d"</span>,
    <span class="java&#45;quote">"roles"</span>: &#91;
        <span class="java&#45;quote">"ADMIN"</span>,
        <span class="java&#45;quote">"USER"</span>
    &#93;
&#125;</pre></div><p class="paragraph"/>This format can be customised with the following configuration keys:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Config key</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.token.rendering.usernamePropertyName</code></td><td><code>username</code></td></tr><tr class="table-even"><td><code>grails.plugin.springsecurity.rest.token.rendering.tokenPropertyName</code></td><td><code>token</code></td></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.token.rendering.authoritiesPropertyName</code></td><td><code>roles</code></td></tr></table><p class="paragraph"/>Eg, with the following configuration:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.<span class="java&#45;keyword">rest</span>.token.rendering.usernamePropertyName = 'login'
grails.plugin.springsecurity.<span class="java&#45;keyword">rest</span>.token.rendering.tokenPropertyName = 'access_token'
grails.plugin.springsecurity.<span class="java&#45;keyword">rest</span>.token.rendering.authoritiesPropertyName = 'permissions'</pre></div><p class="paragraph"/>The output will look like:<p class="paragraph"/><div class="code"><pre>&#123;
    <span class="java&#45;quote">"login"</span>: <span class="java&#45;quote">"john.doe"</span>,
    <span class="java&#45;quote">"access_token"</span>: <span class="java&#45;quote">"1a2b3c4d"</span>,
    <span class="java&#45;quote">"permissions"</span>: &#91;
        <span class="java&#45;quote">"ADMIN"</span>,
        <span class="java&#45;quote">"USER"</span>
    &#93;
&#125;</pre></div><p class="paragraph"/>If you want your own, simply create a class implementing
<a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/com/odobo/grails/plugin/springsecurity/rest/token/rendering/RestAuthenticationTokenJsonRenderer.html" target="blank">RestAuthenticationTokenJsonRenderer</a>
and wire it up in <code>resources.groovy</code> with name <code>restAuthenticationTokenJsonRenderer</code>.<p class="paragraph"/><blockquote class="note">
The principal object stored in the security context, and passed to the JSON renderer, is coming from the configured
authentication providers. In most cases, this will be a <code>UserDetails</code> object retrieved using the <code>userDetailsService</code> bean.
If you want to render additional information in your JSON response, you have to:
<ol>
<li>Configure an alternative <code>userDetailsService</code> bean that retrieves the additional information you want, and put it in a principal object.</li>
<li>Configure an alternative <code>restAuthenticationTokenJsonRenderer</code> that reads that information from the <code>restAuthenticationToken.principal</code> object.</li>
</ol><p class="paragraph"/></blockquote><p class="paragraph"/>The following are the <code>Config.groovy</code> properties available:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Config key</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.active</code></td><td><code>true</code></td></tr><tr class="table-even"><td><code>grails.plugin.springsecurity.rest.login.endpointUrl</code></td><td><code>/api/login</code></td></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.failureStatusCode</code></td><td><code>401</code></td></tr></table><p class="paragraph"/><blockquote class="note">
This authentication filter will only be applied to the above configured URL and can also be disabled, in case a different approach
for token creation is followed. In the rest of the cases, the request will continue through the filter chain, reaching Spring Security
Core filters. Bear in mind that, by default, Spring Security Core 2.x locks down all URL's unless a explicit securiy rule has been
specified for each of them.<p class="paragraph"/>See <a href="http://grails-plugins.github.io/grails-spring-security-core/docs/manual/guide/single.html#requestMappings" target="blank">Spring Security Core documentation</a>
for more information.
</blockquote><p class="paragraph"/><h2>Extracting credentials from the request</h2><p class="paragraph"/>The plugin supports 2 ways of extracting the username and password: using request parameters, and using a JSON payload.
To align with the RESTful principles, JSON payload is the default behaviour.<p class="paragraph"/><h3>From a JSON request</h3><p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Config key</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.useJsonCredentials</code></td><td><code>true</code></td></tr><tr class="table-even"><td><code>grails.plugin.springsecurity.rest.login.usernamePropertyName</code></td><td><code>username</code></td></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.passwordPropertyName</code></td><td><code>password</code></td></tr></table><p class="paragraph"/>
The default implementation expects a request like this:<p class="paragraph"/><div class="code"><pre>&#123;
    <span class="java&#45;quote">"username"</span>: <span class="java&#45;quote">"john.doe"</span>,
    <span class="java&#45;quote">"password"</span>: <span class="java&#45;quote">"dontTellAnybody"</span>
&#125;</pre></div><p class="paragraph"/>If you use <code>usernamePropertyName</code> and <code>passwordPropertyName</code> properties mentioned above, your JSON request can look like:<p class="paragraph"/><div class="code"><pre>&#123;
    <span class="java&#45;quote">"login"</span>: <span class="java&#45;quote">"john.doe"</span>,
    <span class="java&#45;quote">"pwd"</span>: <span class="java&#45;quote">"dontTellAnybody"</span>
&#125;</pre></div><p class="paragraph"/>With the following config:<p class="paragraph"/><div class="code"><pre>grails.plugin.springsecurity.<span class="java&#45;keyword">rest</span>.login.usernamePropertyName = 'login'
grails.plugin.springsecurity.<span class="java&#45;keyword">rest</span>.login.passwordPropertyName = 'pwd'</pre></div><p class="paragraph"/>If your JSON request format is different, you can plug your own implementation by defining a class which extends
<code><a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/com/odobo/grails/plugin/springsecurity/rest/AbstractJsonPayloadCredentialsExtractor.html" target="blank">AbstractJsonPayloadCredentialsExtractor</a></code>.
The default implementation looks like this:<p class="paragraph"/><div class="code"><pre>@Slf4j
class DefaultJsonPayloadCredentialsExtractor <span class="java&#45;keyword">extends</span> AbstractJsonPayloadCredentialsExtractor &#123;<p class="paragraph"/>    <span class="java&#45;object">String</span> usernameParameter
    <span class="java&#45;object">String</span> passwordParameter<p class="paragraph"/>    UsernamePasswordAuthenticationToken extractCredentials(HttpServletRequest httpServletRequest) &#123;
        def jsonBody = getJsonBody(httpServletRequest)<p class="paragraph"/>        <span class="java&#45;object">String</span> username = jsonBody.<span class="java&#45;quote">"$&#123;usernameParameter&#125;"</span>
        <span class="java&#45;object">String</span> password = jsonBody.<span class="java&#45;quote">"$&#123;passwordParameter&#125;"</span><p class="paragraph"/>        log.debug <span class="java&#45;quote">"Extracted credentials from JSON payload. Username: $&#123;username&#125;, password: $&#123;password?.size()?'&#91;PROTECTED&#93;':'&#91;MISSING&#93;'&#125;"</span><p class="paragraph"/>        <span class="java&#45;keyword">new</span> UsernamePasswordAuthenticationToken(username, password)
    &#125;<p class="paragraph"/>&#125;</pre></div><p class="paragraph"/>Once you are done, register it in <code>resources.groovy</code> with the name <code>credentialsExtractor</code>.<p class="paragraph"/><h3>From request parameters</h3><p class="paragraph"/>Note that the name of the parameters can also be customised:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Config key</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.useRequestParamsCredentials</code></td><td><code>false</code></td></tr><tr class="table-even"><td><code>grails.plugin.springsecurity.rest.login.usernameParameter</code></td><td><code>username</code></td></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.login.passwordParameter</code></td><td><code>password</code></td></tr></table>



<h2 id="logout">3.1 Logout Endpoint</h2>
The <a href="http://alvarosanchez.github.io/grails-spring-security-rest/docs/gapi/com/odobo/grails/plugin/springsecurity/rest/RestLogoutFilter.html" target="blank">logout filter</a>
exposes an endpoint for deleting tokens. It will read the token from an HTTP header. If found, will delete it from the
storage, sending a 200 response. Otherwise, it will send a 404 response.<p class="paragraph"/>You can configure it in <code>Config.groovy</code> using this properties:<p class="paragraph"/><table class="wiki-table" cellpadding="0" cellspacing="0" border="0"><tr><th><strong class="bold">Config key</strong></th><th><strong class="bold">Default value</strong></th></tr><tr class="table-odd"><td><code>grails.plugin.springsecurity.rest.logout.endpointUrl</code></td><td><code>/api/logout</code></td></tr><tr class="table-even"><td><code>grails.plugin.springsecurity.rest.token.validation.headerName</code></td><td><code>X-Auth-Token</code></td></tr></table>



                <div style="clear:both;margin-top:15px;"></div>
                
                    <div class="toc-item prev-left"><a href="../guide/configuration.html">&lt;&lt; <strong>2</strong><span>Configuration</span></a></div>
                
                    <div class="toc-item next-right"><a href="../guide/tokenGeneration.html"><strong>4</strong><span>Token Generation</span> >></a></div>
                
                <div style="clear:both"></div>
            </div>
        </td>
        <td id="col2">
            <div class="local clearfix">
                <div class="local-title">
                    <a href="../guide/index.html" target="mainFrame">Quick Reference</a>
                    <span class="toggle">(<a href="#" onclick="localToggle(); return false;">hide</a>)</span>
                </div>
                <div class="menu">
                    
                </div>
            </div>
        </td>
    </tr>
</table>

<div id="footer">
    
    
</div>

<script type="text/javascript" src="../js/docs.js"></script>

</body>
</html>
